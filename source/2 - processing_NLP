{"cells":[{"cell_type":"code","execution_count":2,"metadata":{"executionInfo":{"elapsed":6,"status":"ok","timestamp":1671446387627,"user":{"displayName":"Thuật Nguyễn","userId":"09354117644444085141"},"user_tz":-420},"id":"9Y8vN_LaMA-K"},"outputs":[],"source":["import regex as re\n"," \n","uniChars = \"àáảãạâầấẩẫậăằắẳẵặèéẻẽẹêềếểễệđìíỉĩịòóỏõọôồốổỗộơờớởỡợùúủũụưừứửữựỳýỷỹỵÀÁẢÃẠÂẦẤẨẪẬĂẰẮẲẴẶÈÉẺẼẸÊỀẾỂỄỆĐÌÍỈĨỊÒÓỎÕỌÔỒỐỔỖỘƠỜỚỞỠỢÙÚỦŨỤƯỪỨỬỮỰỲÝỶỸỴÂĂĐÔƠƯ\"\n","unsignChars = \"aaaaaaaaaaaaaaaaaeeeeeeeeeeediiiiiooooooooooooooooouuuuuuuuuuuyyyyyAAAAAAAAAAAAAAAAAEEEEEEEEEEEDIIIOOOOOOOOOOOOOOOOOOOUUUUUUUUUUUYYYYYAADOOU\"\n"," \n"," \n","def loaddicchar():\n","    dic = {}\n","    char1252 = 'à|á|ả|ã|ạ|ầ|ấ|ẩ|ẫ|ậ|ằ|ắ|ẳ|ẵ|ặ|è|é|ẻ|ẽ|ẹ|ề|ế|ể|ễ|ệ|ì|í|ỉ|ĩ|ị|ò|ó|ỏ|õ|ọ|ồ|ố|ổ|ỗ|ộ|ờ|ớ|ở|ỡ|ợ|ù|ú|ủ|ũ|ụ|ừ|ứ|ử|ữ|ự|ỳ|ý|ỷ|ỹ|ỵ|À|Á|Ả|Ã|Ạ|Ầ|Ấ|Ẩ|Ẫ|Ậ|Ằ|Ắ|Ẳ|Ẵ|Ặ|È|É|Ẻ|Ẽ|Ẹ|Ề|Ế|Ể|Ễ|Ệ|Ì|Í|Ỉ|Ĩ|Ị|Ò|Ó|Ỏ|Õ|Ọ|Ồ|Ố|Ổ|Ỗ|Ộ|Ờ|Ớ|Ở|Ỡ|Ợ|Ù|Ú|Ủ|Ũ|Ụ|Ừ|Ứ|Ử|Ữ|Ự|Ỳ|Ý|Ỷ|Ỹ|Ỵ'.split(\n","        '|')\n","    charutf8 = \"à|á|ả|ã|ạ|ầ|ấ|ẩ|ẫ|ậ|ằ|ắ|ẳ|ẵ|ặ|è|é|ẻ|ẽ|ẹ|ề|ế|ể|ễ|ệ|ì|í|ỉ|ĩ|ị|ò|ó|ỏ|õ|ọ|ồ|ố|ổ|ỗ|ộ|ờ|ớ|ở|ỡ|ợ|ù|ú|ủ|ũ|ụ|ừ|ứ|ử|ữ|ự|ỳ|ý|ỷ|ỹ|ỵ|À|Á|Ả|Ã|Ạ|Ầ|Ấ|Ẩ|Ẫ|Ậ|Ằ|Ắ|Ẳ|Ẵ|Ặ|È|É|Ẻ|Ẽ|Ẹ|Ề|Ế|Ể|Ễ|Ệ|Ì|Í|Ỉ|Ĩ|Ị|Ò|Ó|Ỏ|Õ|Ọ|Ồ|Ố|Ổ|Ỗ|Ộ|Ờ|Ớ|Ở|Ỡ|Ợ|Ù|Ú|Ủ|Ũ|Ụ|Ừ|Ứ|Ử|Ữ|Ự|Ỳ|Ý|Ỷ|Ỹ|Ỵ\".split(\n","        '|')\n","    for i in range(len(char1252)):\n","        dic[char1252[i]] = charutf8[i]\n","    return dic\n"," \n"," \n","dicchar = loaddicchar()\n"," \n","# Đưa toàn bộ dữ liệu qua hàm này để chuẩn hóa lại\n","def convert_unicode(txt):\n","    return re.sub(\n","        r'à|á|ả|ã|ạ|ầ|ấ|ẩ|ẫ|ậ|ằ|ắ|ẳ|ẵ|ặ|è|é|ẻ|ẽ|ẹ|ề|ế|ể|ễ|ệ|ì|í|ỉ|ĩ|ị|ò|ó|ỏ|õ|ọ|ồ|ố|ổ|ỗ|ộ|ờ|ớ|ở|ỡ|ợ|ù|ú|ủ|ũ|ụ|ừ|ứ|ử|ữ|ự|ỳ|ý|ỷ|ỹ|ỵ|À|Á|Ả|Ã|Ạ|Ầ|Ấ|Ẩ|Ẫ|Ậ|Ằ|Ắ|Ẳ|Ẵ|Ặ|È|É|Ẻ|Ẽ|Ẹ|Ề|Ế|Ể|Ễ|Ệ|Ì|Í|Ỉ|Ĩ|Ị|Ò|Ó|Ỏ|Õ|Ọ|Ồ|Ố|Ổ|Ỗ|Ộ|Ờ|Ớ|Ở|Ỡ|Ợ|Ù|Ú|Ủ|Ũ|Ụ|Ừ|Ứ|Ử|Ữ|Ự|Ỳ|Ý|Ỷ|Ỹ|Ỵ',\n","        lambda x: dicchar[x.group()], txt)"]},{"cell_type":"code","execution_count":1,"metadata":{"executionInfo":{"elapsed":6,"status":"ok","timestamp":1671446387625,"user":{"displayName":"Thuật Nguyễn","userId":"09354117644444085141"},"user_tz":-420},"id":"57JOAS2oBv9q"},"outputs":[],"source":["bang_nguyen_am = [['a', 'à', 'á', 'ả', 'ã', 'ạ', 'a'],\n","                  ['ă', 'ằ', 'ắ', 'ẳ', 'ẵ', 'ặ', 'aw'],\n","                  ['â', 'ầ', 'ấ', 'ẩ', 'ẫ', 'ậ', 'aa'],\n","                  ['e', 'è', 'é', 'ẻ', 'ẽ', 'ẹ', 'e'],\n","                  ['ê', 'ề', 'ế', 'ể', 'ễ', 'ệ', 'ee'],\n","                  ['i', 'ì', 'í', 'ỉ', 'ĩ', 'ị', 'i'],\n","                  ['o', 'ò', 'ó', 'ỏ', 'õ', 'ọ', 'o'],\n","                  ['ô', 'ồ', 'ố', 'ổ', 'ỗ', 'ộ', 'oo'],\n","                  ['ơ', 'ờ', 'ớ', 'ở', 'ỡ', 'ợ', 'ow'],\n","                  ['u', 'ù', 'ú', 'ủ', 'ũ', 'ụ', 'u'],\n","                  ['ư', 'ừ', 'ứ', 'ử', 'ữ', 'ự', 'uw'],\n","                  ['y', 'ỳ', 'ý', 'ỷ', 'ỹ', 'ỵ', 'y']]\n","bang_ky_tu_dau = ['', 'f', 's', 'r', 'x', 'j']"]},{"cell_type":"code","execution_count":3,"metadata":{"executionInfo":{"elapsed":6,"status":"ok","timestamp":1671446387627,"user":{"displayName":"Thuật Nguyễn","userId":"09354117644444085141"},"user_tz":-420},"id":"oNgh0P3oB7u4"},"outputs":[],"source":["nguyen_am_to_ids = {}\n","\n","for i in range(len(bang_nguyen_am)):\n","    for j in range(len(bang_nguyen_am[i]) - 1):\n","        nguyen_am_to_ids[bang_nguyen_am[i][j]] = (i, j)"]},{"cell_type":"code","execution_count":4,"metadata":{"executionInfo":{"elapsed":4,"status":"ok","timestamp":1671446390782,"user":{"displayName":"Thuật Nguyễn","userId":"09354117644444085141"},"user_tz":-420},"id":"qS6dpA3UPaa2"},"outputs":[],"source":["def is_valid_vietnam_word(word):\n","    chars = list(word)\n","    nguyen_am_index = -1\n","    for index, char in enumerate(chars):\n","        x, y = nguyen_am_to_ids.get(char, (-1, -1))\n","        if x != -1:\n","            if nguyen_am_index == -1:\n","                nguyen_am_index = index\n","            else:\n","                if index - nguyen_am_index != 1:\n","                    return False\n","                nguyen_am_index = index\n","    return True"]},{"cell_type":"code","execution_count":5,"metadata":{"executionInfo":{"elapsed":3,"status":"ok","timestamp":1671446393208,"user":{"displayName":"Thuật Nguyễn","userId":"09354117644444085141"},"user_tz":-420},"id":"xXJIP7MiPNYr"},"outputs":[],"source":["def chuan_hoa_dau_tu_tieng_viet(word):\n","    if not is_valid_vietnam_word(word):\n","        return word\n","\n","    chars = list(word)\n","    dau_cau = 0\n","    nguyen_am_index = []\n","    qu_or_gi = False\n","    for index, char in enumerate(chars):\n","        x, y = nguyen_am_to_ids.get(char, (-1, -1))\n","        if x == -1:\n","            continue\n","        elif x == 9:  # check qu\n","            if index != 0 and chars[index - 1] == 'q':\n","                chars[index] = 'u'\n","                qu_or_gi = True\n","        elif x == 5:  # check gi\n","            if index != 0 and chars[index - 1] == 'g':\n","                chars[index] = 'i'\n","                qu_or_gi = True\n","        if y != 0:\n","            dau_cau = y\n","            chars[index] = bang_nguyen_am[x][0]\n","        if not qu_or_gi or index != 1:\n","            nguyen_am_index.append(index)\n","    if len(nguyen_am_index) < 2:\n","        if qu_or_gi:\n","            if len(chars) == 2:\n","                x, y = nguyen_am_to_ids.get(chars[1])\n","                chars[1] = bang_nguyen_am[x][dau_cau]\n","            else:\n","                x, y = nguyen_am_to_ids.get(chars[2], (-1, -1))\n","                if x != -1:\n","                    chars[2] = bang_nguyen_am[x][dau_cau]\n","                else:\n","                    chars[1] = bang_nguyen_am[5][dau_cau] if chars[1] == 'i' else bang_nguyen_am[9][dau_cau]\n","            return ''.join(chars)\n","        return word\n","\n","    for index in nguyen_am_index:\n","        x, y = nguyen_am_to_ids[chars[index]]\n","        if x == 4 or x == 8:  # ê, ơ\n","            chars[index] = bang_nguyen_am[x][dau_cau]\n","            return ''.join(chars)\n","\n","    if len(nguyen_am_index) == 2:\n","        if nguyen_am_index[-1] == len(chars) - 1:\n","            x, y = nguyen_am_to_ids[chars[nguyen_am_index[0]]]\n","            chars[nguyen_am_index[0]] = bang_nguyen_am[x][dau_cau]\n","        else:\n","            x, y = nguyen_am_to_ids[chars[nguyen_am_index[1]]]\n","            chars[nguyen_am_index[1]] = bang_nguyen_am[x][dau_cau]\n","    else:\n","        x, y = nguyen_am_to_ids[chars[nguyen_am_index[1]]]\n","        chars[nguyen_am_index[1]] = bang_nguyen_am[x][dau_cau]\n","    return ''.join(chars)"]},{"cell_type":"code","execution_count":6,"metadata":{"executionInfo":{"elapsed":2,"status":"ok","timestamp":1671446395354,"user":{"displayName":"Thuật Nguyễn","userId":"09354117644444085141"},"user_tz":-420},"id":"vi6CKUBCPpnk"},"outputs":[],"source":["#Chuyển câu tiếng việt về chuẩn gõ dấu kiểu cũ.\n","def chuan_hoa_dau_cau_tieng_viet(sentence):\n","    sentence = sentence.lower()\n","    words = sentence.split()\n","    for index, word in enumerate(words):\n","        cw = re.sub(r'(^\\p{P}*)([p{L}.]*\\p{L}+)(\\p{P}*$)', r'\\1/\\2/\\3', word).split('/')\n","        if len(cw) == 3:\n","            cw[1] = chuan_hoa_dau_tu_tieng_viet(cw[1])\n","        words[index] = ''.join(cw)\n","    return ' '.join(words)"]},{"cell_type":"code","execution_count":7,"metadata":{"id":"Of6Yo56-ap6k","colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"status":"ok","timestamp":1671446406993,"user_tz":-420,"elapsed":871,"user":{"displayName":"Thuật Nguyễn","userId":"09354117644444085141"}},"outputId":"6e8ce3a5-4140-4b3c-becb-59ab050be089"},"outputs":[{"output_type":"stream","name":"stdout","text":["Installing collected packages: underthesea-core, python-crfsuite, underthesea\n","Successfully installed python-crfsuite-0.9.8 underthesea-1.4.0 underthesea-core-0.0.5a2\n"]}],"source":["!pip install underthesea"]},{"cell_type":"code","source":["from google.colab import drive\n","drive.mount('/content/drive')"],"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"4_2tCrQ2HV7C","executionInfo":{"status":"ok","timestamp":1671446428596,"user_tz":-420,"elapsed":21610,"user":{"displayName":"Thuật Nguyễn","userId":"09354117644444085141"}},"outputId":"84704a17-ba93-4767-a5a4-c51e57467dad"},"execution_count":8,"outputs":[{"output_type":"stream","name":"stdout","text":["Mounted at /content/drive\n"]}]},{"cell_type":"code","execution_count":17,"metadata":{"executionInfo":{"elapsed":354,"status":"ok","timestamp":1671446651883,"user":{"displayName":"Thuật Nguyễn","userId":"09354117644444085141"},"user_tz":-420},"id":"85Y-rF8UcaBD"},"outputs":[],"source":["from underthesea import word_tokenize\n","def text_preprocess(document):\n","    # chuẩn hóa unicode\n","    document = convert_unicode(document)\n","    # chuẩn hóa cách gõ dấu tiếng Việt\n","    document = chuan_hoa_dau_cau_tieng_viet(document)\n","    # đưa về lower (chữ thường)\n","    document = document.lower()\n","    # xóa các ký tự không cần thiết\n","    document = re.sub(r'[^\\s\\w%_]',' ',document)\n","    # xóa khoảng trắng thừa \n","    document = re.sub(r'\\s+', ' ', document).strip()\n","    # tách từ\n","    document = word_tokenize(document, format=\"text\")\n","    # Sửa chính tả, lỗi cú pháp, viết tắt, tiếng anh lẫn vào, không dấu bằng tay trên gg sheet\n","    return document"]},{"cell_type":"code","execution_count":18,"metadata":{"executionInfo":{"elapsed":356,"status":"ok","timestamp":1671446657673,"user":{"displayName":"Thuật Nguyễn","userId":"09354117644444085141"},"user_tz":-420},"id":"iLNQPVKEfkyb"},"outputs":[],"source":["import pandas as pd\n","df = pd.read_csv('/content/drive/MyDrive/DS310/datasetNLP/data/dataset3.0.csv')"]},{"cell_type":"code","source":["# lấy số lượng đã gán nhãn\n","df = df[0:2231]"],"metadata":{"id":"zr9OXrhTNoTn","executionInfo":{"status":"ok","timestamp":1671446659928,"user_tz":-420,"elapsed":347,"user":{"displayName":"Thuật Nguyễn","userId":"09354117644444085141"}}},"execution_count":19,"outputs":[]},{"cell_type":"code","source":["# Chuyển kiểu dữ liệu của những feature gán nhãn về dạng int64\n","import numpy as np\n","df['Service'] = df['Service'].astype(np.int64)\n","df['Infrastructure'] = df['Infrastructure'].astype(np.int64)\n","df['Sanitary'] = df['Sanitary'].astype(np.int64)\n","df['Location'] = df['Location'].astype(np.int64)\n","df['Attitude'] = df['Attitude'].astype(np.int64)"],"metadata":{"id":"l8xtVU9DM2Xy","executionInfo":{"status":"ok","timestamp":1671446661474,"user_tz":-420,"elapsed":3,"user":{"displayName":"Thuật Nguyễn","userId":"09354117644444085141"}}},"execution_count":20,"outputs":[]},{"cell_type":"code","source":["# Thực hiện tiền xử lí data\n","for i in range(len(df)):\n","  df['Comment'][i] = text_preprocess(df['Comment'][i])"],"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"dteo4YaCfce2","executionInfo":{"status":"ok","timestamp":1671446669719,"user_tz":-420,"elapsed":5792,"user":{"displayName":"Thuật Nguyễn","userId":"09354117644444085141"}},"outputId":"e72a5078-8dd9-4598-b475-da196f0e1c55"},"execution_count":21,"outputs":[{"output_type":"stream","name":"stderr","text":["<ipython-input-21-2b78f37dfafc>:2: SettingWithCopyWarning: \n","A value is trying to be set on a copy of a slice from a DataFrame\n","\n","See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy\n","  df['Comment'][i] = text_preprocess(df['Comment'][i])\n"]}]},{"cell_type":"code","source":["df.to_csv('dataset_final.csv', index=False, header=True)"],"metadata":{"id":"yasmxlK7gU98","executionInfo":{"status":"ok","timestamp":1671446669719,"user_tz":-420,"elapsed":4,"user":{"displayName":"Thuật Nguyễn","userId":"09354117644444085141"}}},"execution_count":22,"outputs":[]}],"metadata":{"colab":{"provenance":[],"authorship_tag":"ABX9TyOHsC9oIUV7x2a1Hn08Pehu"},"kernelspec":{"display_name":"Python 3","name":"python3"},"language_info":{"name":"python"}},"nbformat":4,"nbformat_minor":0}